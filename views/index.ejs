<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    .loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 20px;
      }
  </style>
</head>
<body>
  <div class="loading">Loading...</div>

  <a-scene id="scene" mindar-image="imageTargetSrc: /<%= userId %>.mind" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
    
    <a-entity mindar-image-target="targetIndex: 0" position="0 0 0">
      
      <a-entity position="0 1 0">
        <a-image src="<%= profileImage %>" width="0.8" height="0.8" position="0 0 0.1"></a-image>
        <a-text value="<%= legalName %>" width="1" align="center" position="0 -0.9 0.1"></a-text>
        <a-text value="Age: <%= age %>" width="1" align="center" position="0 -1.2 0.1"></a-text>
        <a-text value="Blood Type: <%= bloodType %>" color="red" width="1" align="center" position="0 -1.5 0.1"></a-text>
      </a-entity>

      <!-- High Risk Section -->
      <a-entity position="-1.5 0 0">
        <a-plane width="1.5" height="2" color="#ececec"></a-plane>
        <a-text value="High Risk" width="1.4" color="red" align="center" position="0 0.8 0.1"></a-text>
        
        <a-text value="Conditions" width="1.2" color="red" align="left" position="-0.6 0.4 0.1"></a-text>
        <% harmfulMedicalConditions.forEach((condition, index) => { %>
          <a-text value="<%= condition.name %>" width="1.2" align="left" position="-0.6 <%= 0.2 - index * 0.3 %> 0.1"></a-text>
        <% }) %>

        <a-text value="Medications" width="1.2" color="red" align="left" position="-0.6 -0.6 0.1"></a-text>
        <% harmfulMedications.forEach((medication, index) => { %>
          <a-text value="<%= medication.name %>" width="1.2" align="left" position="-0.6 <%= -0.8 - index * 0.3 %> 0.1"></a-text>
        <% }) %>
      </a-entity>

      <!-- Allergies Section -->
      <a-entity position="1.5 0 0">
        <a-plane width="1.5" height="1" color="#ececec"></a-plane>
        <a-text value="Allergies" width="1.4" color="red" align="center" position="0 0.4 0.1"></a-text>
        <% allergies.forEach((allergy, index) => { %>
          <a-text value="<%= allergy.name %>" width="1.2" align="center" position="0 <%= 0.2 - index * 0.3 %> 0.1"></a-text>
        <% }) %>
      </a-entity>

      <!-- Emergency Contacts Section -->
      <a-entity position="-1.5 -2.5 0">
        <a-plane width="1.5" height="1" color="#ececec"></a-plane>
        <a-text value="Emergency Contacts" width="1.4" align="center" position="0 0.4 0.1"></a-text>
        <% emergencyContacts.forEach((contact, index) => { %>
          <a-text value="<%= contact.name %>: <%= contact.number %>" width="1.2" align="center" position="0 <%= 0.2 - index * 0.3 %> 0.1"></a-text>
        <% }) %>
      </a-entity>

      <!-- Doctor Contacts Section -->
      <a-entity position="1.5 -2.5 0">
        <a-plane width="1.5" height="1" color="#ececec"></a-plane>
        <a-text value="Doctor Contacts" width="1.4" align="center" position="0 0.4 0.1"></a-text>
        <% doctorContacts.forEach((contact, index) => { %>
          <a-text value="<%= contact.name %>: <%= contact.number %>" width="1.2" align="center" position="0 <%= 0.2 - index * 0.3 %> 0.1"></a-text>
        <% }) %>
      </a-entity>

    </a-entity>
  </a-scene>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Hide loading indicator
      document.querySelector('.loading').style.display = 'none';
      document.querySelector('#scene').setAttribute('visible', 'true');
    });
  </script>
</body>
</html>
